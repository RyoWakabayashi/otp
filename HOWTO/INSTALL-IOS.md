Cross Compiling Erlang/OTP - IOS
====================================

Introduction
------------

This document describes how to cross compile Erlang/OTP to iOS platforms.


### Get xcode Tools ###

iOS binaries can only be crosscompiled from apple macos computers. Get a mac and install xcode

### Environment Variables ###

    $ export RELEASE_LIBBEAM=yes

### Configure Erlang/OTP ###

If you are building Erlang/OTP from git, you will need to run this
to generate the configure scripts.

    $ ./otp_build autoconf


    $ # Either without OpenSSL support:
    $
    $ ./otp_build configure \
         --xcomp-conf=./xcomp/erl-xcomp-ios64-xcrun.conf  \
         --without-ssl


    $ # Or with OpenSSL linked statically:
    $
    $ 1.1.1k works, but needs a manual patch in ios cross build config to include
    # engines
    $ ./otp_build configure \
         --xcomp-conf=./xcomp/erl-xcomp-ios64-xcrun.conf  \
         --with-ssl=/path/to/libcrypto.a \
         --disable-dynamic-ssl-lib


### Compile Erlang/OTP ###

    $ ./otp_build boot

### Linking a binary with your App ###
    To use the resulting libbeam.a it needs to be packaged into a an xcodeframework package together
    with all other required .a files. These include:

    - libbeam.a
    - liberts.a
    - libz.a
    - libcrypto.a
    - ...

    Basically all .a files that have been generated by the build.

    One way of creating a combined archive out of all of these is to extract each archive into a temporary
    folder and create a new archive:

    $ mkdir tmp
    $ cd tmp
    $ ar -x /Path/to/libbeam.a 
    $ ar -x /Path/to/liberts.a 
    $ ar -x /Path/to/....a 

    This list should also include static nifs you want to include

    And then combine all object files in that tmp directory into one new archive:

    $ ar -rcvu liberlang.a *.o

    Finally packaging the archive into a xcodeframework file:

    $ xcodebuild -create-xcframework -output ./liberlang.xcframework -library liberlang.a

    If you're building for multiple iOS targets (e.g. emulator and phone)

    $ xcodebuild -create-xcframework -output ./liberlang.xcframework -library /Path/to/phonelib/liberlang.a -library /Path/to/simulatorlib/liberlang.a
